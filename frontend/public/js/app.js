"use strict";function getGet(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=n.exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}var debug={log:function(e){void 0!=getGet("debug")&&console.log(e)}};$(document).ready(function(e){debug.log("Inits checking in"),$(".modal-trigger").leanModal()});var userSessionControl=function(){var e=this;debug.log("Loginform init"),this.data={authIntent:"login",user:void 0},this.toggleIntent=function(){"login"==e.data.authIntent?e.data.authIntent="register":e.data.authIntent="login"},this.setLoginUI=function(){function t(){debug.log("Setting register"),$("#logintitle, #loginbutton").html("Register"),$("#toggleintent").html("Log into existing account")}function n(){debug.log("Setting login"),$("#logintitle, #loginbutton").html("Login"),$("#toggleintent").html("Register an account")}debug.log("Adapt login modal GUI"),$("#loginform input").val(""),"login"==e.data.authIntent?n():t()},this.loginRegister=function(){var t=$("#loginuser").val(),n=$("#loginpassword").val(),o=function(){return"login"==e.data.authIntent?"/login/local":"/register/new"},i=$.ajax({url:o(),method:"POST",data:{username:t,password:n}});i.done(function(t){debug.log("Login succeeded with status:"),debug.log(t),e.data.user=t,$("#loginmessage").html("Login complete!").removeClass("hide"),$("#loginmodal").closeModal(),e.setLoginHeaderUI()}),i.fail(function(e,t){debug.log(e),debug.log(t),$("#loginmessage").html("Login failed!").removeClass("hide")})},this.setLoginHeaderUI=function(){void 0!=e.data.user?(debug.log(e.data.user),$("#loggedoutmenu").addClass("hide"),$("#loggedinmenu").removeClass("hide"),$("#logoutmenubutton").html("Logout "+e.data.user.email)):($("#loggedoutmenu").removeClass("hide"),$("#loggedinmenu").addClass("hide"),$("#logoutmenubutton").html("Logout")),$("#loginmessage").html("").addClass("hide")},this.getCurrentUser=function(t){$.ajax({url:"/login/current",method:"GET"}).done(function(n){void 0!=n.email&&(debug.log("User session retreived: "),debug.log(n),e.data.user=n),t()}).fail(function(n,o){debug.log("No user session"),e.data.user=null,t()})},this.updateGlobalUI=function(){debug.log("Update global UI"),e.getCurrentUser(e.setLoginHeaderUI)},this.triggers=function(){$("#loginmodal").on("click","#toggleintent",function(t){t.preventDefault(),e.toggleIntent(),e.setLoginUI()}).on("submit","#loginform",function(t){t.preventDefault(),"login"==e.data.authIntent?e.loginRegister():"register"==e.data.authIntent&&e.loginRegister(),e.setLoginUI()}),$("#nav").on("click","#logoutmenubutton",function(t){t.preventDefault(),$.get("/login/destroy",function(t){debug.log("User logged out with: "+t),e.data.user=void 0,e.setLoginHeaderUI()})})},this.dynamicUpdate=function(){setInterval(e.updateGlobalUI,1e4)}};$(document).ready(function(e){debug.log("Session control checking in ");var t=new userSessionControl;t.updateGlobalUI(),t.triggers(),t.dynamicUpdate()});
//# sourceMappingURL=app.js.map
